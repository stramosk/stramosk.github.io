class u{canvas;ctx;animationId=0;sigma=10;rho=28;beta=2.667;x=.1;y=.1;z=.1;dt=.01;isRunning=!1;points=[];maxPoints=1e4;rotationX=0;rotationY=0;zoom=1;isDragging=!1;lastMouseX=0;lastMouseY=0;constructor(){this.canvas=document.getElementById("lorenzCanvas"),this.ctx=this.canvas.getContext("2d"),this.setupCanvas(),this.setupEventListeners(),this.reset()}setupCanvas(){const t=this.canvas.getBoundingClientRect();this.canvas.width=t.width,this.canvas.height=500}setupEventListeners(){document.getElementById("sigma")?.addEventListener("input",t=>{this.sigma=parseFloat(t.target.value),document.getElementById("sigmaValue").textContent=this.sigma.toFixed(1)}),document.getElementById("rho")?.addEventListener("input",t=>{this.rho=parseFloat(t.target.value),document.getElementById("rhoValue").textContent=this.rho.toFixed(1)}),document.getElementById("beta")?.addEventListener("input",t=>{this.beta=parseFloat(t.target.value),document.getElementById("betaValue").textContent=this.beta.toFixed(3)}),document.getElementById("startBtn")?.addEventListener("click",()=>this.start()),document.getElementById("pauseBtn")?.addEventListener("click",()=>this.pause()),document.getElementById("resetBtn")?.addEventListener("click",()=>this.reset()),document.getElementById("clearBtn")?.addEventListener("click",()=>this.clear()),this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.onMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.onMouseUp.bind(this)),this.canvas.addEventListener("wheel",this.onWheel.bind(this))}onMouseDown(t){this.isDragging=!0,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY}onMouseMove(t){if(!this.isDragging)return;const s=t.clientX-this.lastMouseX,i=t.clientY-this.lastMouseY;this.rotationY+=s*.01,this.rotationX+=i*.01,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY}onMouseUp(){this.isDragging=!1}onWheel(t){t.preventDefault();const s=t.deltaY>0?.9:1.1;this.zoom*=s,this.zoom=Math.max(.1,Math.min(5,this.zoom))}start(){this.isRunning||(this.isRunning=!0,this.animate())}pause(){this.isRunning=!1,this.animationId&&cancelAnimationFrame(this.animationId)}reset(){this.pause(),this.x=.1,this.y=.1,this.z=.1,this.points=[],this.rotationX=0,this.rotationY=0,this.zoom=1,this.draw()}clear(){this.points=[],this.draw()}animate(){this.isRunning&&(this.updateLorenz(),this.points.push({x:this.x,y:this.y,z:this.z}),this.points.length>this.maxPoints&&this.points.shift(),this.draw(),this.animationId=requestAnimationFrame(()=>this.animate()))}updateLorenz(){const t=this.sigma*(this.y-this.x),s=this.x*(this.rho-this.z)-this.y,i=this.x*this.y-this.beta*this.z;this.x+=t*this.dt,this.y+=s*this.dt,this.z+=i*this.dt}project3DTo2D(t,s,i){const e=Math.cos(this.rotationY),n=Math.sin(this.rotationY),o=Math.cos(this.rotationX),a=Math.sin(this.rotationX);let r=t*e-i*n,h=t*n+i*e,d=s*o-h*a;h=s*a+h*o;const c=100*this.zoom,l=this.canvas.width/2,x=this.canvas.height/2;return{x:l+r*c,y:x+d*c}}draw(){this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawGrid(),this.drawAttractor(),this.drawAxes()}drawGrid(){this.ctx.strokeStyle="#333333",this.ctx.lineWidth=1;for(let t=0;t<this.canvas.width;t+=50)this.ctx.beginPath(),this.ctx.moveTo(t,0),this.ctx.lineTo(t,this.canvas.height),this.ctx.stroke();for(let t=0;t<this.canvas.height;t+=50)this.ctx.beginPath(),this.ctx.moveTo(0,t),this.ctx.lineTo(this.canvas.width,t),this.ctx.stroke()}drawAxes(){const t=this.project3DTo2D(0,0,0),s=this.project3DTo2D(1,0,0),i=this.project3DTo2D(0,1,0),e=this.project3DTo2D(0,0,1);this.ctx.strokeStyle="#ff6b6b",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(s.x,s.y),this.ctx.stroke(),this.ctx.strokeStyle="#51cf66",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(i.x,i.y),this.ctx.stroke(),this.ctx.strokeStyle="#339af0",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(e.x,e.y),this.ctx.stroke()}drawAttractor(){if(this.points.length<2)return;this.ctx.strokeStyle="#ffffff",this.ctx.lineWidth=1,this.ctx.beginPath();const t=this.project3DTo2D(this.points[0].x,this.points[0].y,this.points[0].z);this.ctx.moveTo(t.x,t.y);for(let i=1;i<this.points.length;i++){const e=this.points[i],n=this.project3DTo2D(e.x,e.y,e.z);this.ctx.lineTo(n.x,n.y)}this.ctx.stroke();const s=this.project3DTo2D(this.x,this.y,this.z);this.ctx.fillStyle="#ff6b6b",this.ctx.beginPath(),this.ctx.arc(s.x,s.y,4,0,2*Math.PI),this.ctx.fill()}}window.addEventListener("load",()=>{new u});
