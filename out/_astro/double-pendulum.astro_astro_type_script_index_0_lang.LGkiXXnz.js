class v{canvas;ctx;animationId=null;isRunning=!1;startTime=0;currentTime=0;length1=100;length2=100;mass1=2;mass2=2;gravity=9.81;angle1=45*Math.PI/180;angle2=45*Math.PI/180;angularVelocity1=0;angularVelocity2=0;scale=4;centerX=400;centerY=200;constructor(){this.canvas=document.getElementById("doublePendulumCanvas"),this.ctx=this.canvas.getContext("2d"),this.setupEventListeners(),this.draw()}setupEventListeners(){const t=document.getElementById("length1"),a=document.getElementById("length2"),h=document.getElementById("mass1"),c=document.getElementById("mass2"),l=document.getElementById("angle1"),n=document.getElementById("angle2"),i=document.getElementById("gravity"),e=document.getElementById("length1Value"),o=document.getElementById("length2Value"),r=document.getElementById("mass1Value"),g=document.getElementById("mass2Value"),u=document.getElementById("angle1Value"),d=document.getElementById("angle2Value"),m=document.getElementById("gravityValue"),y=document.getElementById("startBtn"),x=document.getElementById("pauseBtn"),I=document.getElementById("resetBtn");t.addEventListener("input",s=>{this.length1=Number(s.target.value),e.textContent=(this.length1/10).toFixed(1),this.draw()}),a.addEventListener("input",s=>{this.length2=Number(s.target.value),o.textContent=(this.length2/10).toFixed(1),this.draw()}),h.addEventListener("input",s=>{this.mass1=Number(s.target.value),r.textContent=this.mass1.toFixed(1)}),c.addEventListener("input",s=>{this.mass2=Number(s.target.value),g.textContent=this.mass2.toFixed(1)}),l.addEventListener("input",s=>{this.angle1=Number(s.target.value)*Math.PI/180,u.textContent=`${Math.round(this.angle1*180/Math.PI)}째`,this.draw()}),n.addEventListener("input",s=>{this.angle2=Number(s.target.value)*Math.PI/180,d.textContent=`${Math.round(this.angle2*180/Math.PI)}째`,this.draw()}),i.addEventListener("input",s=>{this.gravity=Number(s.target.value),m.textContent=this.gravity.toFixed(2)}),y.addEventListener("click",()=>this.start()),x.addEventListener("click",()=>this.pause()),I.addEventListener("click",()=>this.reset())}start(){this.isRunning||(this.isRunning=!0,this.startTime=performance.now(),this.animate())}pause(){this.isRunning=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}reset(){this.pause(),this.angle1=45*Math.PI/180,this.angle2=45*Math.PI/180,this.angularVelocity1=0,this.angularVelocity2=0,this.currentTime=0,this.startTime=0,this.updateDisplays(),this.draw()}animate(){if(!this.isRunning)return;this.updatePhysics(.016),this.updateDisplays(),this.draw(),this.animationId=requestAnimationFrame(()=>this.animate())}updatePhysics(t){this.currentTime+=t;const a=this.gravity,h=this.length1/10,c=this.length2/10,l=this.mass1,n=this.mass2,i=this.angle1-this.angle2,e=Math.sin(i),o=Math.cos(i),r=n*a*Math.sin(this.angle2)*o-n*e*(h*this.angularVelocity1*this.angularVelocity1*o+c*this.angularVelocity2*this.angularVelocity2)-(l+n)*a*Math.sin(this.angle1),g=h*(l+n*e*e),u=r/g,d=n*e*(h*this.angularVelocity1*this.angularVelocity1+a*Math.cos(this.angle1))+(l+n)*(h*this.angularVelocity1*this.angularVelocity1*e-a*Math.sin(this.angle2)),m=c*(l+n*e*e),y=d/m;this.angularVelocity1+=u*t,this.angularVelocity2+=y*t,this.angle1+=this.angularVelocity1*t,this.angle2+=this.angularVelocity2*t}updateDisplays(){const t=document.getElementById("currentAngle1"),a=document.getElementById("currentAngle2"),h=document.getElementById("currentVelocity1"),c=document.getElementById("currentVelocity2"),l=document.getElementById("totalEnergy"),n=document.getElementById("simTime");t.textContent=`${(this.angle1*180/Math.PI).toFixed(2)}째`,a.textContent=`${(this.angle2*180/Math.PI).toFixed(2)}째`,h.textContent=`${this.angularVelocity1.toFixed(2)} rad/s`,c.textContent=`${this.angularVelocity2.toFixed(2)} rad/s`,n.textContent=`${this.currentTime.toFixed(2)}s`;const i=this.length1/10,e=this.length2/10,o=this.mass1,r=this.mass2,g=this.gravity,u=i*this.angularVelocity1,d=Math.sqrt(Math.pow(i*this.angularVelocity1,2)+Math.pow(e*this.angularVelocity2,2)+2*i*e*this.angularVelocity1*this.angularVelocity2*Math.cos(this.angle1-this.angle2)),m=.5*o*u*u+.5*r*d*d,y=i*(1-Math.cos(this.angle1)),x=i*(1-Math.cos(this.angle1))+e*(1-Math.cos(this.angle2)),I=o*g*y+r*g*x,s=m+I;l.textContent=`${s.toFixed(2)} J`}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawGrid(),this.drawPendulum()}drawGrid(){this.ctx.strokeStyle="rgba(255, 255, 255, 0.1)",this.ctx.lineWidth=1;for(let t=0;t<=this.canvas.width;t+=50)this.ctx.beginPath(),this.ctx.moveTo(t,0),this.ctx.lineTo(t,this.canvas.height),this.ctx.stroke();for(let t=0;t<=this.canvas.height;t+=50)this.ctx.beginPath(),this.ctx.moveTo(0,t),this.ctx.lineTo(this.canvas.width,t),this.ctx.stroke()}drawPendulum(){const t=this.length1/10*this.scale,a=this.length2/10*this.scale,h=this.centerX+t*Math.sin(this.angle1),c=this.centerY+t*Math.cos(this.angle1),l=h+a*Math.sin(this.angle2),n=c+a*Math.cos(this.angle2);this.ctx.fillStyle="rgba(255, 255, 255, 0.8)",this.ctx.beginPath(),this.ctx.arc(this.centerX,this.centerY,8,0,2*Math.PI),this.ctx.fill(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.6)",this.ctx.lineWidth=4,this.ctx.beginPath(),this.ctx.moveTo(this.centerX,this.centerY),this.ctx.lineTo(h,c),this.ctx.stroke(),this.ctx.fillStyle="rgba(255, 100, 100, 0.8)",this.ctx.beginPath(),this.ctx.arc(h,c,12,0,2*Math.PI),this.ctx.fill(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.6)",this.ctx.lineWidth=4,this.ctx.beginPath(),this.ctx.moveTo(h,c),this.ctx.lineTo(l,n),this.ctx.stroke(),this.ctx.fillStyle="rgba(100, 100, 255, 0.8)",this.ctx.beginPath(),this.ctx.arc(l,n,12,0,2*Math.PI),this.ctx.fill(),this.ctx.strokeStyle="rgba(100, 100, 255, 0.5)",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(l,n);for(let i=1;i<=20;i++){const e=i*.016,o=this.angle1-this.angularVelocity1*e,r=this.angle2-this.angularVelocity2*e,g=this.centerX+t*Math.sin(o),u=this.centerY+t*Math.cos(o),d=g+a*Math.sin(r),m=u+a*Math.cos(r);this.ctx.lineTo(d,m)}this.ctx.stroke()}}window.addEventListener("load",()=>{new v});
